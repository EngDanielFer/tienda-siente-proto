<section class="bg-white py-8 antialiased md:py-16">
    <div class="mx-auto max-w-screen-xl px-4 2xl:px-0">
        <div class="mx-auto max-w-5xl">
            <h2 class="text-xl font-semibold text-gray-900 sm:text-2xl mb-6">Método de envío</h2>
        </div>

        <ol class="items-center w-full space-y-4 sm:flex sm:space-x-8 sm:space-y-0 rtl:space-x-reverse mb-8">
            <li class="flex items-center text-green-600 space-x-2.5 rtl:space-x-reverse">
                <span
                    class="flex items-center justify-center w-8 h-8 border border-green-600 rounded-full shrink-0 bg-green-600 text-white">
                    ✓
                </span>
                <span>
                    <h3 class="font-medium leading-tight">Datos del usuario</h3>
                </span>
            </li>
            <li class="flex items-center text-blue-600 space-x-2.5 rtl:space-x-reverse">
                <span class="flex items-center justify-center w-8 h-8 border border-blue-600 rounded-full shrink-0">
                    2
                </span>
                <span>
                    <h3 class="font-medium leading-tight">Datos de envío</h3>
                </span>
            </li>
            <li class="flex items-center text-gray-500 space-x-2.5 rtl:space-x-reverse">
                <span class="flex items-center justify-center w-8 h-8 border border-gray-500 rounded-full shrink-0">
                    3
                </span>
                <span>
                    <h3 class="font-medium leading-tight">Pago</h3>
                </span>
            </li>
        </ol>

        <div class="mt-6 sm:mt-8 lg:flex lg:items-start lg:gap-12">
            <form #formEnvio="ngForm" (ngSubmit)="onSubmit(formEnvio)"
                class="w-full rounded-lg border border-gray-200 bg-white p-4 shadow-sm sm:p-6 lg:max-w-xl lg:p-8">
                <div class="mb-6">
                    <h3 class="text-lg font-semibold text-gray-900 mb-4">Selecciona el método de envío</h3>

                    <div class="space-y-4">
                        <div *ngFor="let metodo of metodosEnvio"
                            class="border rounded-lg p-4 cursor-pointer transition-all hover:border-blue-500"
                            [class.border-blue-600]="metodoEnvioSeleccionado === metodo.id"
                            [class.bg-blue-50]="metodoEnvioSeleccionado === metodo.id"
                            (click)="onSeleccionarMetodo(metodo)">
                            <div class="flex items-start">
                                <input type="radio" [id]="'metodo-' + metodo.id" name="metodoEnvio" [value]="metodo.id"
                                    [(ngModel)]="metodoEnvioSeleccionado" required
                                    class="mt-1 w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 focus:ring-blue-500">
                                <label [for]="'metodo-' + metodo.id" class="ms-3 flex-1 cursor-pointer">
                                    <div class="flex justify-between items-start mb-1">
                                        <span class="text-base font-semibold text-gray-900">
                                            {{ metodo.nombre }}
                                        </span>
                                        <span class="text-base font-bold text-gray-900">
                                            {{ metodo.precio === 0 ? 'GRATIS' : (metodo.precio | currency) }}
                                        </span>
                                    </div>
                                    <p class="text-sm text-gray-600">{{ metodo.descripcion }}</p>
                                    <p class="text-xs text-gray-500 mt-1">
                                        Tiempo estimado: {{ metodo.tiempoEstimado }}
                                    </p>
                                </label>
                            </div>
                        </div>
                    </div>

                    <p *ngIf="!metodoEnvioSeleccionado && formEnvio.submitted" class="text-red-500 text-sm mt-2">
                        Por favor seleccionar un método de envío
                    </p>
                </div>

                <div class="space-y-3">
                    <button type="submit"
                        class="flex w-full items-center justify-center rounded-lg bg-blue-600 px-5 py-2.5 text-sm font-medium text-white hover:bg-blue-700 focus:outline-none focus:ring-4 focus:ring-blue-300">
                        Continuar al pago
                    </button>

                    <button type="button" (click)="volverAtras()"
                        class="flex w-full items-center justify-center rounded-lg border border-gray-300 bg-white px-5 py-2.5 text-sm font-medium text-gray-700 hover:bg-gray-100 focus:outline-none focus:ring-4 focus:ring-gray-200">
                        Volver atrás
                    </button>
                </div>
            </form>

            <div class="mt-6 grow sm:mt-8 lg:mt-0">
                <div class="space-y-4 rounded-lg border border-gray-100 bg-gray-50 p-6">
                    <h3 class="text-lg font-semibold text-gray-900 mb-4">Resumen del pedido</h3>

                    <div class="space-y-2">
                        <dl class="flex items-center justify-between gap-4">
                            <dt class="text-base font-normal text-gray-500">Precio de los productos</dt>
                            <dd class="text-base font-medium text-gray-900">{{ cartState.precio() | currency }}</dd>
                        </dl>

                        <dl class="flex items-center justify-between gap-4">
                            <dt class="text-base font-normal text-gray-500">Envío</dt>
                            <dd class="text-base font-medium text-gray-900">
                                {{ costoEnvio === 0 ? 'Gratis' : (costoEnvio | currency) }}
                            </dd>
                        </dl>

                        <dl class="flex items-center justify-between gap-4 border-t border-gray-200 pt-2">
                            <dt class="text-base font-bold text-gray-900">Total</dt>
                            <dd class="text-base font-bold text-gray-900">
                                {{ (cartState.precio() + costoEnvio) | currency }}
                            </dd>
                        </dl>

                        <div *ngIf="obtenerMetodoSeleccionado()"
                            class="mt-4 p-3 bg-blue-50 rounded-lg border border-blue-200">
                            <p class="text-sm text-gray-700">
                                <span class="font-semibold">Método seleccionado:</span>
                                {{ obtenerMetodoSeleccionado()?.nombre }}
                            </p>
                            <p class="text-xs text-gray-600 mt-1">
                                {{ obtenerMetodoSeleccionado()?.descripcion }}
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>