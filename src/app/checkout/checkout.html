<section class="bg-white py-8 antialiased md:py-16">
    <div class="mx-auto max-w-screen-xl px-4 2xl:px-0">
        <div class="mx-auto max-w-5xl">
            <h2 class="text-xl font-semibold text-gray-900 sm:text-2xl mb-6">Finalizar compra</h2>
        </div>

        <ol class="items-center w-full space-y-4 sm:flex sm:space-x-8 sm:space-y-0 rtl:space-x-reverse mb-8">
            <li class="flex items-center text-green-600 space-x-2.5 rtl:space-x-reverse">
                <span
                    class="flex items-center justify-center w-8 h-8 border border-green-600 rounded-full shrink-0 bg-green-600 text-white">
                    ✓
                </span>
                <span>
                    <h3 class="font-medium leading-tight">Datos del usuario</h3>
                </span>
            </li>
            <li class="flex items-center text-green-600 space-x-2.5 rtl:space-x-reverse">
                <span
                    class="flex items-center justify-center w-8 h-8 border border-green-600 rounded-full shrink-0 bg-green-600 text-white">
                    ✓
                </span>
                <span>
                    <h3 class="font-medium leading-tight">Datos de envío</h3>
                </span>
            </li>
            <li class="flex items-center text-blue-600 space-x-2.5 rtl:space-x-reverse">
                <span class="flex items-center justify-center w-8 h-8 border border-blue-600 rounded-full shrink-0">
                    3
                </span>
                <span>
                    <h3 class="font-medium leading-tight">Pago</h3>
                </span>
            </li>
        </ol>

        <div *ngIf="error" class="mb-6 p-4 text-sm text-red-800 rounded-lg bg-red-50 border border-red-200"
            role="alert">
            <span class="font-medium">Error:</span> {{ error }}
        </div>

        <div class="mt-6 sm:mt-8 lg:flex lg:items-start lg:gap-12">
            <form #formCheckout="ngForm" (ngSubmit)="onSubmit(formCheckout)"
                class="w-full rounded-lg border border-gray-200 bg-white p-4 shadow-sm sm:p-6 lg:max-w-xl lg:p-8">

                <div class="mb-6 p-4 bg-gray-50 rounded-lg">
                    <h3 class="text-lg font-semibold text-gray-900 mb-3">
                        Información de envío
                    </h3>
                    <div class="space-y-2 text-sm">
                        <p><span class="font-medium text-gray-700">Cliente:</span>
                            {{ datosCliente.nombre_cliente }} {{ datosCliente.apellido_cliente }}</p>
                        <p><span class="font-medium text-gray-700">Email:</span>
                            {{ datosCliente.email_cliente }}</p>
                        <p><span class="font-medium text-gray-700">Teléfono:</span>
                            {{ datosCliente.telefono_cliente }}</p>
                        <p><span class="font-medium text-gray-700">Dirección:</span>
                            {{ datosCliente.direccion_cliente }}</p>
                        <p *ngIf="datosCliente.complemento_direccion">
                            <span class="font-medium text-gray-700">Complemento:</span>
                            {{ datosCliente.complemento_direccion }}
                        </p>
                        <p><span class="font-medium text-gray-700">Ciudad:</span>
                            {{ datosCliente.ciudad_cliente }}, {{ datosCliente.region_cliente }}</p>
                        <p><span class="font-medium text-gray-700">País:</span>
                            {{ datosCliente.pais_cliente }}</p>
                    </div>
                </div>

                <div class="mb-6">
                    <h3 class="text-lg font-semibold text-gray-900 mb-4">
                        Selecciona el método de pago
                    </h3>

                    <div class="space-y-3">
                        <div *ngFor="let metodo of metodosPago"
                            class="border rounded-lg p-4 cursor-pointer transition-all hover:border-blue-500"
                            [class.border-blue-600]="metodoPagoSeleccionado === metodo.id"
                            [class.bg-blue-50]="metodoPagoSeleccionado === metodo.id"
                            (click)="onSeleccionarMetodoPago(metodo)">
                            <div class="flex items-center">
                                <input type="radio" [id]="'metodo-pago-' + metodo.id" name="metodoPago"
                                    [value]="metodo.id" [(ngModel)]="metodoPagoSeleccionado" required
                                    class="w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 focus:ring-blue-500">

                                <label [for]="'metodo-pago-' + metodo.id" class="ms-3 flex-1 cursor-pointer">
                                    <div class="flex items-center gap-2">
                                        <span class="text-2xl">{{ metodo.icono }}</span>
                                        <div>
                                            <p class="text-base font-semibold text-gray-900">
                                                {{ metodo.nombre }}
                                            </p>
                                            <p class="text-xs text-gray-600">{{ metodo.descripcion }}</p>
                                        </div>
                                    </div>
                                </label>
                            </div>
                        </div>
                    </div>

                    <p *ngIf="!metodoPagoSeleccionado && formCheckout.submitted" class="text-red-500 text-sm mt-2">
                        Es necesario seleccionar un método de pago
                    </p>
                </div>

                <div class="mb-6">
                    <div class="flex items-start">
                        <input id="terminos" name="terminos" type="checkbox" required ngModel #terminos="ngModel"
                            class="w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500">
                        <label for="terminos" class="ms-2 text-sm text-gray-700">
                            Acepto los
                            <a href="#" class="text-blue-600 hover:underline">términos y condiciones</a>
                            y la
                            <a href="#" class="text-blue-600 hover:underline">política de privacidad</a>
                        </label>
                    </div>
                    <p *ngIf="terminos.invalid && terminos.touched" class="text-red-500 text-xs mt-1">
                        Debes aceptar los términos y condiciones
                    </p>
                </div>

                <div class="space-y-3">
                    <button type="submit" [disabled]="procesando"
                        class="flex w-full items-center justify-center rounded-lg bg-green-600 px-5 py-2.5 text-sm font-medium text-white hover:bg-green-700 focus:outline-none focus:ring-4 focus:ring-green-300 disabled:opacity-50 disabled:cursor-not-allowed">
                        <span *ngIf="!procesando">Realizar pedido</span>
                        <span *ngIf="procesando" class="flex items-center gap-2">
                            <svg class="animate-spin h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none"
                                viewBox="0 0 24 24">
                                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor"
                                    stroke-width="4"></circle>
                                <path class="opacity-75" fill="currentColor"
                                    d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z">
                                </path>
                            </svg>
                            Procesando...
                        </span>
                    </button>

                    <button type="button" (click)="volverAtras()" [disabled]="procesando"
                        class="flex w-full items-center justify-center rounded-lg border border-gray-300 bg-white px-5 py-2.5 text-sm font-medium text-gray-700 hover:bg-gray-100 focus:outline-none focus:ring-4 focus:ring-gray-200 disabled:opacity-50">
                        Volver atrás
                    </button>
                </div>
            </form>

            <div class="mt-6 grow sm:mt-8 lg:mt-0">
                <div class="space-y-4 rounded-lg border border-gray-100 bg-gray-50 p-6">
                    <h3 class="text-lg font-semibold text-gray-900 mb-4">
                        Resumen del pedido
                    </h3>

                    <div class="space-y-3 mb-4">
                        <div *ngFor="let producto of cartState.productos()"
                            class="flex justify-between text-sm pb-3 border-b border-gray-200">
                            <div class="flex-1">
                                <p class="font-medium text-gray-900">{{ producto.producto.nombre_producto }}</p>
                                <p class="text-gray-500">Cantidad: {{ producto.cantidad }}</p>
                            </div>
                            <p class="font-medium text-gray-900">
                                {{ (producto.producto.precio_por_mayor) | currency }}
                            </p>
                        </div>
                    </div>

                    <div class="space-y-2">
                        <dl class="flex items-center justify-between gap-4">
                            <dt class="text-base font-normal text-gray-500">Subtotal</dt>
                            <dd class="text-base font-medium text-gray-900">
                                {{ cartState.precio() | currency }}
                            </dd>
                        </dl>

                        <dl class="flex items-center justify-between gap-4">
                            <dt class="text-base font-normal text-gray-500">Envío</dt>
                            <dd class="text-base font-medium text-gray-900">
                                {{ datosEnvio.precio_envio === 0 ? 'Gratis' : (datosEnvio.precio_envio | currency) }}
                            </dd>
                        </dl>
                    </div>

                    <dl class="flex items-center justify-between gap-4 border-t border-gray-200 pt-2">
                        <dt class="text-lg font-bold text-gray-900">Total</dt>
                        <dd class="text-lg font-bold text-green-600">
                            {{ obtenerTotal() | currency }}
                        </dd>
                    </dl>

                    <div *ngIf="obtenerMetodoSeleccionado()"
                        class="mt-4 p-3 bg-blue-50 rounded-lg border border-blue-200">
                        <p class="text-sm text-gray-700">
                            <span class="font-semibold">Método de pago:</span>
                            {{ obtenerMetodoSeleccionado()?.nombre }}
                        </p>
                        <p class="text-xs text-gray-600 mt-1">
                            {{ obtenerMetodoSeleccionado()?.descripcion }}
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>